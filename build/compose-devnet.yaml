# This compose file contains the Anvil devnet container for the node.

name: rollups-node
services:
  devnet:
    image: cartesi/rollups-node-devnet:devel
    ports:
      - 8545:8545

  cli:
    depends_on:
      database:
        condition: service_healthy
    image: cartesi/rollups-node-cli:devel
    command: cartesi-rollups-cli db upgrade -p postgres://postgres:password@database:5432/postgres?sslmode=disable

  node:
    depends_on:
      devnet:
        condition: service_healthy
    environment:
      CARTESI_BLOCKCHAIN_ID: "31337"
      CARTESI_BLOCKCHAIN_HTTP_ENDPOINT: "http://devnet:8545"
      CARTESI_BLOCKCHAIN_WS_ENDPOINT: "ws://devnet:8545"
      CARTESI_LEGACY_BLOCKCHAIN_ENABLED: "false"
      CARTESI_BLOCKCHAIN_FINALITY_OFFSET: "1"
      CARTESI_CONTRACTS_APPLICATION_ADDRESS: "0x1b0FAD42f016a9EBa358c7491A67fa1fAE82912A"
      CARTESI_CONTRACTS_ICONSENSUS_ADDRESS: "0x3fd5dc9dCf5Df3c7002C0628Eb9AD3bb5e2ce257"
      CARTESI_CONTRACTS_INPUT_BOX_ADDRESS: "0x593E5BCf894D6829Dd26D0810DA7F064406aebB6"
      CARTESI_CONTRACTS_INPUT_BOX_DEPLOYMENT_BLOCK_NUMBER: "10"
      CARTESI_EPOCH_LENGTH: "120"
      CARTESI_FEATURE_MACHINE_HASH_CHECK_ENABLED: "false"
      CARTESI_AUTH_KIND: "mnemonic"
      CARTESI_AUTH_MNEMONIC: "test test test test test test test test test test test junk"
      CARTESI_POSTGRES_SSLMODE_ENABLED: "false"
